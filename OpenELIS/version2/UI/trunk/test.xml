<?xml version="1.0" encoding="utf-8" ?>
<project name="TestWidget" default="test.dev" basedir=".">
	<!-- Arguments to gwtc and devmode targets -->
	<property name="gwt.args" value="" />

	<!-- Configure path to GWT SDK -->
	<property name="gwt.sdk" location="/usr/local/java/gwt-2.6.0" />
	<property name="junit.home" location="/usr/local/java/junit"/>
	<property name="checkstyle.home" location="/usr/local/java/checkstyle-5.7" />
	<property name="findbugs.home" location="/usr/local/java/findbugs-2.0.3" />
	<property name="selenium.home" location="/usr/local/java/selenium-2.41.0" />
	<property name="jboss.home" location="/usr/local/java/wildfly-8.0.0.Final"/>
	
	<taskdef name="findbugs" classpath="${findbugs.home}/lib/findbugs-ant.jar" classname="edu.umd.cs.findbugs.anttask.FindBugsTask" />

	<path id="project.class.path">
		<pathelement location="${gwt.sdk}/gwt-user.jar" />
		<pathelement location="bin" />
		<fileset dir="${gwt.sdk}" includes="gwt-dev*.jar" />
		<!-- Add any additional non-server libs (such as JUnit) -->
		<fileset dir="lib" includes="*.jar" />
		<fileset dir="${jboss.home}/bin/client" includes="jboss-client.jar" />
		<fileset dir="${jboss.home}/modules/system/layers/base/javax/websocket/api/main" includes="jboss-websocket-api_1.0_spec-1.0.0.Final.jar" />
		<fileset dir="${jboss.home}/modules/system/layers/base/javax/persistence/api/main" includes="*.jar" />
	</path>

	<target name="javac.tests" description="Compiles test code">
		<javac srcdir="test" includes="**" encoding="utf-8" source="1.7" target="1.7" nowarn="true" destdir="bin" debug="true" debuglevel="lines,vars,source">
			<classpath location="${junit.home}/junit-4.11.jar" />
			<classpath refid="project.class.path" />
		</javac>
	</target>

	<target name="test.dev" depends="javac.tests" description="Run development mode tests">
		<sleep seconds="5" />
		<delete dir="reports"/>
		<mkdir dir="reports/junit" />
		<junit includeantruntime="true" fork="yes" showoutput="true" printsummary="withOutAndErr" haltonfailure="no">
			<jvmarg line="-Xmx256m" />
			<sysproperty key="gwt.args" value="-standardsMode -logLevel WARN" />
			<sysproperty key="java.awt.headless" value="true" />
			<classpath>
				<pathelement location="src" />
				<pathelement location="test"/>
				<pathelement location="bin" />
				<path refid="project.class.path" />
				<pathelement location="${gwt.sdk}/validation-api-1.0.0.GA.jar" />
				<pathelement location="${gwt.sdk}/validation-api-1.0.0.GA-sources.jar" />
				<pathelement location="${junit.home}/junit-4.11.jar" />
				<fileset dir="${selenium.home}/libs/" includes="*.jar" />
			</classpath>
			<batchtest todir="reports/junit">
				<fileset dir="test">
					<include name="**/Gwt*.java" />
				</fileset>
			</batchtest>
			<formatter type="plain" />
			<formatter type="xml" />
		</junit>
	</target>

	<target name="findbugs">
		<mkdir dir="reports/findbugs" />

		<findbugs home="${findbugs.home}" output="xml" outputFile="reports/findbugs/fb.xml">
			<sourcePath path="src" />
			<class location="bin" />
		</findbugs>
	</target>

	<target name="checkstyle" description="Generate a report of code convention violations.">
		<taskdef resource="checkstyletask.properties" classpath="${checkstyle.home}/checkstyle-5.7-all.jar" />

		<mkdir dir="reports/checkstyle" />

		<checkstyle config="${checkstyle.home}/sun_checks.xml" failureProperty="checkstyle.failure" failOnViolation="false">
			<formatter type="xml" tofile="reports/checkstyle/checkstyle_report.xml" />
			<fileset dir="src" includes="**/*.java" />
		</checkstyle>

		<style in="reports/checkstyle/checkstyle_report.xml" out="reports/checkstyle/checkstyle_report.html" style="${checkstyle.home}/contrib/checkstyle-noframes.xsl" />
	</target>



</project>
